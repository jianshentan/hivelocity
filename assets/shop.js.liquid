$( document ).ready( function() {

    // Navigation 
    var navigation = $( "nav" ),
        body = $( "body" );
    navigation.hide();

    $( ".open_navigation" ).click( function() {
        openNavigation( navigationState.PRODUCT );
        navigation.show();
        body.css( "overflow", "hidden" );
    });

    $( ".open_cart" ).click( function() {
        openNavigation( navigationState.CART );
        navigation.show();
        body.css( "overflow", "hidden" );
    });


    cart();
    
    // Routing
    var s = document.URL.split("/");
    var url = s[s.length-1];
    switch (url) {
        case "/":
        case "":
            var header = $( "header" );
            header.addClass( "home" );

            $( window ).scroll( function() {
                if( $( this ).scrollTop() > 650 ) {
                    header.removeClass( "home" );
                } else {
                    header.addClass( "home" );
                }
            });
            break;
    }
});

var navigationState = {
    PRODUCT: 0,
    CART: 1
}
var openNavigation = function( state ) {

    var productNavigation = $( ".product_navigation" ),
        cartNavigation = $( ".cart_navigation" ),
        products = $( ".products" ),
        cart = $( ".cart" );

    function removeUnderlines() {
        cartNavigation.removeClass( "underline" );
        productNavigation.removeClass( "underline" );
    }

    function hideAll() {
        cart.addClass( "hide" );
        products.addClass( "hide" );
    }

    hideAll();
    removeUnderlines();

    if( state === navigationState.PRODUCT ) {
        productNavigation.addClass( "underline" );
        products.removeClass( "hide" );
    } else if ( state === navigationState.CART ) {
        cartNavigation.addClass( "underline" );
        cart.removeClass( "hide" );
    }

    cartNavigation.click( function() {
        removeUnderlines();
        hideAll();
        cartNavigation.addClass( "underline" );
        cart.removeClass( "hide" );
    });

    productNavigation.click( function() {
        removeUnderlines();
        hideAll();
        productNavigation.addClass( "underline" );
        products.removeClass( "hide" );
    });

    $( ".close_navigation" ).click( function() {
        $( "nav" ).hide();
        $( "body" ).css( "overflow", "auto" );
    });
};

var cart = function() {
    var cartContainer = $( "form.cart" );
    cartContainer.find( ".remove" ).each( function() {

        var removeButton = $( this );
        removeButton.click( function( e ) {

            var cartItem= $( e.target ).parent(),
                id = cartItem.attr( "data-id" ),
                qty = cartItem.attr( "data-quantity" );

            $.get( "/cart/change/" + id + "?quantity=0", function() {

                $.when( cartItem.remove() )
                .then( function() {
                    if( $( "#cart" ).find( ".cart-item" ).length === 0 ) {
                        alert( "HERE" );
                        $( "#cart_wrapper" ).html( "CART IS EMPTY" );
                    }
                });

            });
        });

    });
};
